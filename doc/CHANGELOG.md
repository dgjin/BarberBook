# 更新日志 (Changelog)

## [v1.0.6] - 2024-05-22 11:30:00
### 安全与配置
- **配置优先级调整**: 
  - 调整了数据库配置的加载逻辑，现在**强制优先**使用环境变量 (`SUPABASE_URL`, `SUPABASE_KEY`)。
  - 只有在环境变量未配置或无效时，才允许从浏览器的 LocalStorage 读取配置。
- **后台管理强化**:
  - 当系统检测到环境变量已生效时，管理后台的“数据存储连接”区域将自动锁定。
  - 显示“环境变量已生效”的安全指示器，并隐藏敏感的输入框，防止运行时被意外覆盖。

## [v1.0.5] - 2024-05-22 11:00:00
### 修复与优化
- **配置鲁棒性**: 修复了 `Invalid Supabase Config` 和 URL 构造错误。
  - 增加了对 `process.env` 的安全访问，防止在非 Node 环境下报错。
  - 增加了对 URL 格式的严格校验 (`isValidUrl`)，避免无效配置导致应用崩溃。
  - **环境参数支持**: 现在支持从环境变量 (`SUPABASE_URL`, `SUPABASE_KEY`, `API_KEY`) 中自动读取配置，如果本地存储中没有有效配置，将自动回退使用环境变量。
  - **双重保障**: 在更新数据库连接时，增加了 URL 合法性检查，防止用户输入非法字符。

## [v1.0.4] - 2024-05-22 10:30:15
### 新增
- **系统操作日志 (Audit Logs)**: 实现自动化的操作审计功能。
  - **自动记录**: 任何对数据的变更（如创建预约、取消预约、签到、修改配置、增删理发师）都会被系统自动捕获并记录时间戳和详情。
  - **可视化查询**: 在“管理后台”新增“系统日志”标签页，支持查看最近的操作记录，便于管理员追溯业务变更。
  - **数据库支持**: 同步更新 Supabase 表结构，新增 `logs` 表以支持云端日志持久化。

## [v1.0.3] - 2024-05-22 10:15:00
### 新增
- **预约提醒**: 新增智能提醒功能。当预约开始前30分钟内，系统会：
  - 在应用顶部显示醒目的提示横幅。
  - (若授权) 发送浏览器系统级通知，确保用户即使未停留在当前标签页也能收到提醒。

## [v1.0.2] - 2024-05-21 16:45:12
### 新增
- **排队动态看板**: 在主页新增“今日排队动态”区域，按理发师分组展示当日预约队列，支持显示预约人姓名和当前状态（已完成、进行中、等待中）。
- **扫码签到校验**: 增强了扫码签到逻辑。
  - 校验预约状态。
  - 校验排队顺序：若当前时间前仍有未完成的预约，禁止签到并提示“前方还有顾客未完成”。
- **文档中心**: 新增 `doc` 目录，归档数据库脚本、系统设计说明书及更新日志。

### 优化
- **预约流程**: 优化时间段选择逻辑，现在会禁用当前日期已经过去的时间段，防止用户预约“过去的时间”。
- **UI/UX**: 优化了看板卡片的展示样式，增加了顾客姓名的截断显示和状态指示灯。

## [v1.0.1] - 2024-05-20 11:20:33
### 优化
- **理发师管理**: 重构后台理发师管理界面。
  - 支持图片上传功能（前端利用 Canvas 自动压缩至 300x300，转为 Base64 存储）。
  - 优化头像预览和编辑体验，支持本地文件选择或 URL 输入。
  - 列表页增加二维码预览快捷按钮。

## [v1.0.0] - 2024-05-18 09:00:00
### 初始化
- **核心功能上线**:
  - 用户预约流程（选择理发师 -> 日期 -> 时间 -> 信息）。
  - 二维码生成与扫码签到/预约。
  - AI 发型顾问（集成 Google Gemini API）。
  - 后台管理（系统配置、理发师管理、预约列表）。
  - 数据存储支持 Supabase 和 LocalStorage 双模式。
