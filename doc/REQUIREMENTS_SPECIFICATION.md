
# BarberBook Pro 系统需求规格说明书 (SRS)

## 1. 引言

### 1.1 编写目的
本文档旨在详细描述 BarberBook Pro 单位理发室预约系统的功能需求、业务逻辑及非功能性需求，为开发、测试及部署提供基准依据。

### 1.2 项目背景
针对单位/企业内部理发室存在的排队混乱、预约困难及理发师资源分配不均等问题，开发一套轻量级、智能化的预约管理系统。系统支持员工精准预约特定理发师，并限制预约周期以保证公平性。

---

## 2. 系统概述

### 2.1 用户角色
1.  **普通用户（员工）**：
    *   查看理发师列表及排班。
    *   发起预约（选择理发师、日期、时间段）。
    *   查看我的预约及二维码凭证。
    *   使用 AI 发型顾问咨询发型建议。
    *   扫码签到（自助终端模式）。
2.  **管理员**：
    *   管理理发师信息（增删改查）。
    *   配置系统参数（营业时间、服务时长、最大接待量）。
    *   查看系统操作日志。
    *   查看并管理所有预约记录（取消违规预约）。

### 2.2 核心业务流程
1.  **预约流程**：选择理发师 -> 选择未来 7 天内的日期 -> 选择空闲时间段 -> 填写联系信息 -> 生成预约凭证。
2.  **服务流程**：到店 -> 出示二维码/自助扫码 -> 系统校验（时间/顺序） -> 完成签到 -> 开始服务。

---

## 3. 功能需求详细说明

### 3.1 预约子系统 (Booking System)

#### 3.1.1 理发师选择
*   **需求描述**：用户必须先指定一位理发师进行预约。
*   **功能点**：
    *   展示理发师列表，包含头像、姓名、擅长风格（如“渐变”、“长发造型”）及简介。
    *   支持点击理发师卡片进入排期页面。

#### 3.1.2 智能排期与时间选择
*   **需求描述**：系统需根据配置自动生成可用时间段，并执行严格的日期限制。
*   **业务规则**：
    1.  **周期限制**：仅开放**当前日期起未来 7 天**（含当天）的预约，超过 7 天不可选。
    2.  **节假日过滤**：系统需内置节假日逻辑，自动将周末（周六、周日）及法定节假日标记为“休息”，不可预约。
    3.  **时间段生成**：根据“开门时间”、“关门时间”及“单次服务时长”（如 45 分钟）自动切分时间片。
    4.  **过期过滤**：对于当天的预约，已过去的时间段必须置灰不可选。
    5.  **满员控制**：
        *   **单日上限**：每位理发师每日最大服务人数（如 10 人），达到上限后当天显示“已满”。
        *   **时段冲突**：同一理发师在同一时间段只能接受一个预约。

#### 3.1.3 预约确认与凭证
*   **需求描述**：用户提交信息后生成唯一凭证。
*   **输入项**：姓名（必填）、联系电话（必填）。
*   **输出**：
    *   生成唯一的预约 ID。
    *   生成包含预约 ID 的二维码图片。
    *   提供“保存图片”功能以便离线展示。

### 3.2 签到与排队子系统 (Check-in & Queue)

#### 3.2.1 扫码签到
*   **需求描述**：通过摄像头扫描预约二维码进行状态变更。
*   **校验逻辑**：
    1.  **有效性校验**：二维码是否属于系统内有效预约。
    2.  **状态校验**：仅 `BOOKED`（已预约）状态可签到。
    3.  **顺序校验（防插队）**：系统需检查该理发师在当前时间段之前，是否存在未完成（状态仍为 `BOOKED`）的预约。若存在，提示“前方还有顾客未完成”，禁止签到。

#### 3.2.2 排队看板 (Dashboard)
*   **需求描述**：实时展示理发室当前的忙闲状态。
*   **展示内容**：
    *   **今日动态**：按理发师分组，显示当日预约队列。
    *   **状态标识**：高亮显示当前正在服务的顾客，区分已完成和候补顾客。
    *   **周视图**：宏观展示未来一周每位理发师的预约饱和度（空闲/繁忙/已满）。

### 3.3 AI 发型顾问 (AI Advisor)

*   **需求描述**：集成生成式 AI 模型提供咨询服务。
*   **技术实现**：
    *   调用 Google Gemini API (`gemini-3-flash-preview` 或更高版本)。
    *   **Context**：预设系统提示词“你是一位专业的发型师和理发顾问...”。
*   **交互**：用户输入自然语言（如“圆脸适合什么短发？”），系统实时流式返回建议。

### 3.4 后台管理子系统 (Admin Panel)

#### 3.4.1 基础配置
*   **参数设置**：
    *   每日最大预约数 (Max Slots)。
    *   营业时间范围 (Opening/Closing Time)。
    *   服务时长 (Slot Duration)。
*   **数据连接**：支持配置 Supabase 数据库连接字符串，或仅使用本地存储。

#### 3.4.2 理发师管理
*   **功能**：添加新理发师、编辑现有信息、删除理发师。
*   **图片处理**：前端自动压缩上传的头像图片（限制 300px），优化存储性能。
*   **专属二维码**：可生成特定理发师的“直达预约二维码”，供打印张贴。

#### 3.4.3 日志审计
*   **功能**：记录系统内的关键操作（预约创建、取消、配置修改）。
*   **字段**：操作时间、操作类型、详情描述。

---

## 4. 非功能性需求

### 4.1 性能要求
*   **响应速度**：页面加载时间 < 1秒。
*   **并发处理**：在使用 Supabase 后端时，需支持多人同时操作不发生数据覆盖（通过乐观更新或数据库锁机制，目前版本采用简单的覆盖逻辑，生产环境建议升级）。

### 4.2 数据持久化与兼容性
*   **双模存储**：
    1.  **LocalStorage**：默认模式，数据保存在浏览器，适合单机演示。
    2.  **Supabase (PostgreSQL)**：配置后自动切换，支持云端数据同步。
*   **浏览器兼容**：支持 Chrome, Safari, Edge 等主流现代浏览器（需支持 ES6+ 及 Camera API）。

### 4.3 安全性
*   **权限控制**：
    *   普通用户无需登录即可预约。
    *   管理员后台需简单的手机号/验证码认证（演示版采用模拟验证）。
*   **隐私保护**：敏感配置（如 API Key）优先从环境变量读取，前端界面自动脱敏显示。

---

## 5. 附录：数据字典

### 5.1 预约状态 (AppointmentStatus)
| 状态码 | 含义 | 说明 |
| :--- | :--- | :--- |
| `BOOKED` | 已预约 | 初始状态，等待服务 |
| `COMPLETED` | 已完成 | 用户已到店扫码签到 |
| `CANCELLED` | 已取消 | 用户或管理员取消预约 |

### 5.2 系统设置默认值
*   **开门时间**: 08:00
*   **关门时间**: 17:00
*   **单次时长**: 45 分钟
*   **最大预约**: 10 人/天/理发师
